{"title":"在ES的PostgreSql中使用JSONB","uid":"537e66c74d7eb8b9f47d0409dbb02915","slug":"postgre-jsonb","date":"2023-03-28T07:07:16.000Z","updated":"2023-03-28T08:21:14.200Z","comments":true,"path":"api/articles/postgre-jsonb.json","keywords":null,"cover":"https://cdn.pixabay.com/photo/2013/10/09/02/27/lake-192990_960_720.jpg","content":"<h1 id=\"引言\"><a href=\"#引言\" class=\"headerlink\" title=\"引言\"></a>引言</h1><p>​</p>\n<p>通过本文可掌握在pg数据库中如何正确使用json字段，如何进行数据查询，在where子查询中如何使用，以及对json值进行聚合查询使用.</p>\n<p>​</p>\n<h1 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h1><p>JSON 代表 JavaScript Object Notation。JSON是开放的标准格式，由key-value对组成。JSON的主要用于在服务器与web应用之间传输数据。新建表如下：</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">CREATE TABLE &quot;public&quot;.&quot;biz_orders&quot; (  &quot;ID&quot; int8 NOT NULL DEFAULT nextval(&#39;&quot;biz_orders_ID_seq&quot;&#39;::regclass),\n  &quot;info&quot; json NOT NULL\n);</code></pre>\n\n<p>表初始化语句：</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">INSERT INTO &quot;biz_orders&quot;(&quot;ID&quot;, &quot;info&quot;) VALUES (1, &#39;&#123;&quot;name&quot;:&quot;张三&quot;,&quot;items&quot;:&#123;&quot;product&quot;:&quot;啤酒&quot;,&quot;qty&quot;:6&#125;&#125;&#39;);\nINSERT INTO &quot;biz_orders&quot;(&quot;ID&quot;, &quot;info&quot;) VALUES (2, &#39;&#123;&quot;name&quot;:&quot;李四&quot;,&quot;items&quot;:&#123;&quot;product&quot;:&quot;辣条&quot;,&quot;qty&quot;:8&#125;&#125;&#39;);\nINSERT INTO &quot;biz_orders&quot;(&quot;ID&quot;, &quot;info&quot;) VALUES (3, &#39;&#123;&quot;name&quot;:&quot;王五&quot;,&quot;items&quot;:&#123;&quot;product&quot;:&quot;苹果&quot;,&quot;qty&quot;:18&#125;&#125;&#39;);\nINSERT INTO &quot;biz_orders&quot;(&quot;ID&quot;, &quot;info&quot;) VALUES (4, &#39;&#123;&quot;name&quot;:&quot;赵一&quot;,&quot;items&quot;:&#123;&quot;product&quot;:&quot;香蕉&quot;,&quot;qty&quot;:20&#125;&#125;&#39;);</code></pre>\n\n<p>​</p>\n<h1 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h1><p>1、简单查询</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">select * from biz_orders;</code></pre>\n\n<p><img src=\"https://img.onl/gvOSY9\"></p>\n<p>2、查询使用-&gt;操作符，查询json中所有顾客作为键</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">SELECT info -&gt; &#39;name&#39; AS customer FROM biz_orders;</code></pre>\n\n<p><img src=\"https://img.onl/Hd5V7v\"></p>\n<p>3、下面使用-&gt;&gt;操作获取所有顾客姓名作为值</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">SELECT info -&gt;&gt; &#39;name&#39; AS customer FROM biz_orders;</code></pre>\n\n<p><img src=\"https://img.onl/Q7LElp\"></p>\n<p>4、根据json对象的key查询值</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">SELECT\n   info -&gt; &#39;items&#39; -&gt;&gt; &#39;product&#39; as product\nFROM\n   biz_orders\nORDER BY\n   product;</code></pre>\n\n<p><img src=\"https://img.onl/vSp2hM\"></p>\n<p>5、where查询中使用json字段​​​​​​​</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">SELECT\n   info -&gt;&gt; &#39;name&#39; AS customer\nFROM\n   biz_orders\nWHERE\n   info -&gt; &#39;items&#39; -&gt;&gt; &#39;product&#39; &#x3D; &#39;辣条&#39;</code></pre>\n\n<p><img src=\"https://img.onl/RQz04q\"></p>\n<p>6、case 查询​​​​​​​</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">SELECT\n   info -&gt;&gt; &#39;name&#39; AS customer,\n   info -&gt; &#39;items&#39; -&gt;&gt; &#39;product&#39; AS product\nFROM\n   biz_orders\nWHERE\n   CAST (\n      info -&gt; &#39;items&#39; -&gt;&gt; &#39;qty&#39; AS INTEGER\n   ) &#x3D; 6</code></pre>\n\n<p>​</p>\n<p>7、聚合函数​​​​​​​</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">SELECT\n  MIN( CAST ( info -&gt; &#39;items&#39; -&gt;&gt; &#39;qty&#39; AS INTEGER ) ),\n  MAX( CAST ( info -&gt; &#39;items&#39; -&gt;&gt; &#39;qty&#39; AS INTEGER ) ),\n  SUM( CAST ( info -&gt; &#39;items&#39; -&gt;&gt; &#39;qty&#39; AS INTEGER ) ),\n  AVG( CAST ( info -&gt; &#39;items&#39; -&gt;&gt; &#39;qty&#39; AS INTEGER ) ) \nFROM\n  biz_orders;</code></pre>\n\n<p><img src=\"https://img.onl/thT2en\"></p>\n<p>8、类型查询​​​​​​​</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">SELECT\n  json_typeof ( info -&gt; &#39;items&#39; -&gt; &#39;qty&#39; ) \nFROM\n  biz_orders;</code></pre>\n\n<p><img src=\"https://img.onl/DQ9Q4m\"></p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>通过以上例子，知道在pg数据库中如何存储json数据，并且掌握基本的查询，在查询条件中使用json，在聚合函数中使用。虽然，关系型数据库的强项不是在于json处理，而MongoDb或者Redis等NoSQL更适合做这类处理，但是在不引入一个新数据存储的情况下，利用现有架构解决生产问题。随着pg甚至mysql不断向前发展，相信未来对于json等数据支持会越来越好，性能也会越来越高。</p>\n","feature":true,"text":"引言​ 通过本文可掌握在pg数据库中如何正确使用json字段，如何进行数据查询，在where子查询中如何使用，以及对json值进行聚合查询使用. ​ 概述JSON 代表 JavaScript Object Notation。JSON是开放的标准格式，由key-value对组成。J...","link":"","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"postgreSQL","slug":"postgreSQL","count":4,"path":"api/tags/postgreSQL.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%BC%95%E8%A8%80\"><span class=\"toc-text\">引言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">概述</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8\"><span class=\"toc-text\">使用</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li></ol>","author":{"name":"Sh1mwww","slug":"blog-author","avatar":"https://img.onl/qZjVAP","link":"/","description":"及时行乐","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"PostgreSQL数据的存储基础知识","uid":"ad53f22647fa1ab58dafd47d2fbb69ce","slug":"postgreSql","date":"2023-03-28T08:23:16.000Z","updated":"2023-03-28T08:51:32.235Z","comments":true,"path":"api/articles/postgreSql.json","keywords":null,"cover":"https://img.onl/pNC1WP","text":"PostgerSQL对象标识符对象标识符是PostSQL很重要的一个特征，需要熟练掌握。 OIDOID 是 PostgreSQL 内部用于标识数据库对象(数据库，表**，视图，**存储过程等等)的标识符，用4个字节的无符号整数表示。它是PostgreSQL大部分系统表的主键。 类...","link":"","photos":[],"count_time":{"symbolsCount":"7.8k","symbolsTime":"7 mins."},"categories":[],"tags":[{"name":"postgreSQL","slug":"postgreSQL","count":4,"path":"api/tags/postgreSQL.json"}],"author":{"name":"Sh1mwww","slug":"blog-author","avatar":"https://img.onl/qZjVAP","link":"/","description":"及时行乐","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"PostgreSQL和MySQL性能比较","uid":"4d40d05723fa24dd61a0704313888ecd","slug":"postgres-mysql","date":"2023-03-28T06:55:41.000Z","updated":"2023-03-28T07:15:51.483Z","comments":true,"path":"api/articles/postgres-mysql.json","keywords":null,"cover":"https://cdn.pixabay.com/photo/2017/05/09/03/46/alberta-2297204_960_720.jpg","text":"简介​在 Arctype 社区里，我们回答了很多关于数据库性能的问题，尤其是 PostgreSQL 和 MySQL 这两个之间的性能问题。在管理数据库中，性能是一项至关重要而又复杂的任务。它可能受到配置、硬件、或者是操作系统的影响。PostgreSQL 和 MySQL 是否具有稳...","link":"","photos":[],"count_time":{"symbolsCount":"3.5k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"mysql","slug":"mysql","count":1,"path":"api/tags/mysql.json"},{"name":"postgreSQL","slug":"postgreSQL","count":4,"path":"api/tags/postgreSQL.json"}],"author":{"name":"Sh1mwww","slug":"blog-author","avatar":"https://img.onl/qZjVAP","link":"/","description":"及时行乐","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}